<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nurse! Please help.</title>
    <style>
        /* Your existing styles */
    </style>
</head>
<body>

    <!-- First Card -->
    <div class="card">
        <h1>01/10</h1>
        <h2>Nurse! Could you please come and help me?</h2>
        <iframe class="scratch-embed" src="https://scratch.mit.edu/projects/1058538319/embed" allowtransparency="true" frameborder="0" scrolling="no" allowfullscreen></iframe>
        <p><strong>Click the flag to get the Scratch Cat some help from the nurse.</strong></p>
        <p>Let's start with something funâ€”The Scratch Cat needs help so we need to summon a nurse! Click the flag to see it in action. You'll soon be coding and building to make a real alert button to call for assistance from a nurse.</p>
        <div class="nav-buttons">
            <button onclick="nextPage()">Next &#9654;</button>
        </div>
    </div>

    <!-- Second Card -->
    <div class="card" style="display: none;">
        <h1>02/10</h1>
        <h2>I need some assistance!</h2> 
        <p>Patients at a hospital sometimes need help from their nurses, but the nurses can't be with them all the time. What if we could build an alert button to call a nurse or doctor? Share your ideas on how an alert button could be helpful in a hospital. Type your thoughts below and be part of our word cloud!</p>

        <!-- Word Cloud Image Placeholder -->
        <img id="wordCloud" src="" alt="Word Cloud will appear here">

        <div class="nav-buttons">
            <button onclick="prevPage()">&#9664; Prev</button>
            <div class="input-container">
                <input type="text" id="wordInput" class="text-input" placeholder="Type your idea...">
                <button class="submit-button" onclick="submitWord()">Submit</button>
            </div>
            <button onclick="nextPage()">Next &#9654;</button>
        </div>
    </div>

    <!-- Other Cards Here -->

    <!-- PDF Overlay -->
    <div id="pdfOverlay" class="pdf-overlay" style="display: none;">
        <embed src="https://gtacaus.github.io/legobots/alert.pdf" type="application/pdf" width="80%" height="80%">
        <button class="close-button" onclick="closePDF()">X</button>
    </div>

    <script>
        const token = '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'; // Your GitHub token
        const gistId = '20ba022255783133d8b9808ba1371b42';
        const fileName = 'wordcloudalert.txt';
        const apiUrl = `https://api.github.com/gists/${gistId}`;

        function submitWord() {
            const wordInput = document.getElementById('wordInput');
            const newWord = wordInput.value.trim();

            if (newWord) {
                // Fetch the current content of the gist
                fetch(apiUrl, {
                    headers: {
                        'Authorization': `token ${token}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    const currentContent = data.files[fileName]?.content || '';
                    const updatedContent = currentContent + ' ' + newWord;

                    // Update the gist with the new content
                    const updateData = {
                        "description": "Updated content with new word",
                        "files": {
                            [fileName]: {
                                "content": updatedContent
                            }
                        }
                    };

                    return fetch(apiUrl, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(updateData)
                    });
                })
                .then(response => {
                    if (response.ok) {
                        console.log('Gist updated successfully.');
                        wordInput.value = ''; // Clear the input field
                        generateWordCloud(); // Regenerate the word cloud
                    } else {
                        throw new Error('Failed to update gist');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
        }

        async function generateWordCloud() {
            try {
                const githubUrl = 'https://gist.githubusercontent.com/GTACAus/9cf36ca5a6f29a7cce9a12af1cbf0651/raw/5c3f51250043111974c2eb5469988da7ce86a07c/wordcloudalert.txt';
                const response = await fetch(githubUrl);

                if (!response.ok) {
                    throw new Error('Failed to fetch the text content');
                }

                const article = await response.text();

                const wordCloudResponse = await fetch('https://quickchart.io/wordcloud', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        format: 'png',
                        width: 600,
                        height: 400,
                        fontScale: 15,
                        scale: 'linear',
                        removeStopwords: true,
                        minWordLength: 4,
                        text: article
                    })
                });

                if (!wordCloudResponse.ok) {
                    throw new Error('Failed to generate word cloud');
                }

                const wordCloudBlob = await wordCloudResponse.blob();
                const wordCloudUrl = URL.createObjectURL(wordCloudBlob);

                document.getElementById('wordCloud').src = wordCloudUrl;

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('wordCloud').alt = 'Failed to load word cloud';
            }
        }

        function showPage(index) {
            cards[currentPage].style.display = 'none';
            currentPage = index;
            cards[currentPage].style.display = 'block';
        }

        function nextPage() {
            if (currentPage < cards.length - 1) {
                showPage(currentPage + 1);
            }
        }

        function prevPage() {
            if (currentPage > 0) {
                showPage(currentPage - 1);
            }
        }

        function closePDF() {
            document.getElementById('pdfOverlay').style.display = 'none';
        }

        generateWordCloud(); // Initial word cloud generation

    </script>
</body>
</html>
